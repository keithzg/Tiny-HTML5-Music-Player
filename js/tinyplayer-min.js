/* Tiny HTML5 Music player by Themistokle Benetatos */ function Track(e,i,t,n,a){var d,e=e,l="all_tracks",r="audioMP3_"+e.toString(),o="audio_"+e.toString(),u="audioFile_"+e.toString(),c="audioBTNPlay_"+e.toString(),s="audioBTNImg_"+e.toString(),f="audioSeek_"+e.toString(),g=null,v=null;function h(e,i,t,n,a,d,l){var r=~~(d/60),o=~~(d%60);e.fillStyle="rgba(0,0,0,0.8)",e.fillRect(i,t,n,a),e.font="8pt Arial",e.fillStyle=l,e.textAlign="right",e.fillText((r<10?"0"+r:r)+":"+(o<10?"0"+o:o),n-3,a-4)}function p(){var e=Math.round(g.currentTime);if(v.getContext){var i=v.getContext("2d");if(i.clearRect(0,0,v.clientWidth,v.clientHeight),g.buffered.length>0){i.fillStyle="rgba(245,215,110,0.25)";var t=g.buffered.length>0?g.buffered.length-1:0;i.fillRect(0,0,g.buffered.end(t)/g.duration*v.clientWidth,v.clientHeight)}g.paused?i.fillStyle="rgba(230,126,34,0.3)":i.fillStyle="rgba(230,126,34,0.6)";var n=e/g.duration*v.clientWidth;n>0&&i.fillRect(0,0,n,v.clientHeight),g.duration&&h(i,v.clientWidth-32,v.clientHeight-15,v.clientWidth,v.clientHeight,g.duration,"#BBBBBB"),g.currentTime&&h(i,0,v.clientHeight-15,32,v.clientHeight,g.currentTime,"#e67e22")}}function y(e){var i=document.getElementById(s);if(i.getContext){var t=i.getContext("2d");switch(t.clearRect(0,0,i.clientWidth,i.clientHeight),t.fillStyle="rgb(255,255,255)",e){case"loading":t.beginPath(),t.arc(i.clientWidth/2,i.clientHeight/2,6,0,2*Math.PI,!1),t.fill();break;case"pause":t.fillRect(0,0,i.clientWidth/2-2,i.clientHeight),t.fillRect(i.clientWidth/2+2,0,i.clientWidth,i.clientHeight);break;default:t.beginPath(),t.moveTo(0,0),t.lineTo(0,i.clientHeight),t.lineTo(i.clientHeight,i.clientHeight/2),t.fill()}}}function $(i){b(),i||(i=window.event);try{var t=g.duration*((void 0==i.offsetX?i.layerX:i.offsetX)/v.clientWidth);if(isNaN(t)&&(t=0),g.buffered.length>0){var a=g.buffered.length-1;if(t>g.buffered.end(a)){var d=g.buffered.end(a);d>=0&&d<g.duration&&(t=d)}g.currentTime=t}g.paused&&(null!=n.audio&&n.audio!=g&&n.audio.pause(),g.play(),n.audio=g,n.id=e)}catch(l){console.log("Error while using seek bar: "+l)}}function m(){try{b(),g.paused?(null!=n.audio&&n.audio!=g&&n.audio.pause(),g.play(),n.audio=g,n.id=e):g.pause()}catch(i){console.log("Error while playing mp3 file: "+i)}}function b(){if(!g.src){y("loading");var e=document.getElementById(u);g.src=e.value,v.width=document.getElementById(l).offsetWidth}}(d=document.createElement("div")).id=o,d.className="audioplayer",divContent='<audio id="'+r+"\">Your browser doesn't support HTML5 audio tag.</audio>",divContent+='<div class="audiocontrollers">',divContent+='<input id="'+u+'" type="hidden" value="'+i.url+'" />',divContent+='<div id="'+c+'" class="audiobtnplay">',divContent+='<div class="audiobtnplaybgrd">',divContent+='<canvas id="'+s+'" class="audiobtnimg" width="15" height="15"></canvas>',divContent+="</div>",divContent+="</div>",divContent+='<div class="audiodetails">',divContent+='<div class="audiotitle">'+i.title+"</div>",divContent+='<div class="audioyear">'+i.year+"</div>",divContent+="</div>",divContent+="</div>",divContent+='<div class="audiodisplay">',!0==a?divContent+='<img class="audiowaveform" src="'+i.url+'.png"/>':divContent+='<div class="noaudiowaveform"></div>',divContent+='<canvas id="'+f+'" class="audioSeek" width="'+document.getElementById(l).offsetWidth+'" height="50">Your browser doesn\'t support HTML5 canvas tag.</canvas>',divContent+="</div>",d.innerHTML=divContent,document.getElementById(l).appendChild(d),y("play"),g=document.getElementById(r),v=document.getElementById(f),document.getElementById(c).addEventListener("click",function(e){m()},!1),g.addEventListener("playing",function(){y("pause"),p()},!1),g.addEventListener("pause",function(){y("play"),p()},!1),g.addEventListener("ended",function(){y("play"),this.pause(),this.currentTime=0,p(),t(e)},!1),g.addEventListener("timeupdate",function(){p()},!1),g.addEventListener("progress",function(){p()},!1),v.addEventListener("click",function(e){$(e)},!1),v.addEventListener("mousedown",function(e){document.onmousemove=function(e){$(e)},document.onmouseup=function(){document.onmousemove=null}},!1),window.addEventListener("resize",function(){v.width=document.getElementById(l).offsetWidth},!1),g.addEventListener("error",function e(i){console.log("Error while loading mp3 file: "+i)},!1),this.callback=function(){4==g.readyState&&(g.currentTime=0),m()}}function tinyplayer(e,i,t){window.HTMLAudioElement&&window.addEventListener("DOMContentLoaded",function(){function n(e){try{d[++e<d.length?e:0].callback()}catch(i){console.log("Error while playing next track: "+i)}}t&&function e(i){var t=[{key:"Spacebar",description:"Toggle play / pause"},{key:"[",description:"Play previous track"},{key:"]",description:"Play next track"},{key:"p",description:"Rewind current track"}],n=document.createElement("div");n.id="audiohelp",divContent='<div id="audiohelptitle"><h3>List of available shorcuts:</h3></div>',divContent+='<div id="audiohelpcommands">';for(var a=0;a<t.length;a++)divContent+='<div class="audiohelpshortcuts">',divContent+='<div class="audiohelpkey">'+t[a].key+"</div>",divContent+='<div class="audiohelpdescription">'+t[a].description+"</div>",divContent+="</div>";divContent+="</div>",n.innerHTML=divContent,document.getElementById(i).appendChild(n)}("all_tracks");for(var a={id:null,audio:null},d=[],l=0;l<e.length;l++)d[l]=new Track(l,e[l],n,a,i);window.addEventListener("keydown",function e(i){switch(i.keyCode){case 80:if(i.preventDefault(),null==a.audio)return;a.audio.currentTime=0,a.audio.play();break;case 219:i.preventDefault(),null==a.id&&(a.id=0),function e(i){try{d[--i>=0?i:d.length].callback()}catch(t){console.log("Error while playing previous track: "+t)}}(a.id);break;case 221:i.preventDefault(),null==a.id&&(a.id=0),n(a.id);break;case 32:if(i.preventDefault(),null==a.audio){n(-1);return}a.audio.paused?a.audio.play():a.audio.pause()}},!1)},!1)}
